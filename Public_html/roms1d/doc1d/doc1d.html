<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2K.1beta (1.50)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>$FILE</TITLE>
<META NAME="description" CONTENT="$FILE">
<META NAME="keywords" CONTENT="doc1d">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META NAME="Generator" CONTENT="LaTeX2HTML v2K.1beta">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="doc1d.css">

</HEAD>

<BODY >

<BR>
<BR>
<BR>
<BR>
<BR>
<BR>
<BR>
<BR>
<DIV ALIGN="CENTER">
<FONT SIZE="+3"><B>1D ROMS model documentation</B></FONT> 
<BR><FONT SIZE="+3"><B>*DRAFT*</B></FONT>

</DIV>
<BR>
<BR>
<BR>

<H1><A NAME="SECTION01000000000000000000">
1 Model formulation</A>
</H1>

<P>
This 1D numerical model is derived from the UCLA ROMS 3D ocean model.
It keeps the array structure and the vertical position of the variables.
The mixing closure sub-model, the treatment of vertical advection and
diffusion are compatible with the UCLA ROMS 3D model.

<P>

<H1><A NAME="SECTION01010000000000000000">
1 Equations of motion</A>
</H1>
The primitive hydrostatic equations of an ocean
with no horizontal variations on a Cartesian frame resumes to:
<BR>
<DIV ALIGN="CENTER"><A NAME="eq:umoment"></A><A NAME="eq:vmoment"></A><A NAME="eq:wmoment"></A><A NAME="eq:temp"></A><A NAME="eq:salt"></A><A NAME="eq:cont"></A><A NAME="eq:eos"></A>
<!-- MATH
 \begin{eqnarray}
\frac{\partial u}{\partial t} & = & fv + 
\frac{\partial }{\partial z} \left( K_M \frac{\partial u}{\partial z} \right)
\\\frac{\partial v}{\partial t} & = & - fu + 
\frac{\partial }{\partial z} \left( K_M \frac{\partial v}{\partial z} \right)
\\\frac{\partial P}{\partial z} & = & -\rho g
\\\frac{\partial T}{\partial t} & = & 
w^*\frac{\partial T}{\partial z} + 
\frac{\partial }{\partial z} 
\left(K_T  \frac{\partial T}{\partial z} -\gamma \right) +
\frac{T_{ref} - T}{\tau}
\\\frac{\partial S}{\partial t} & = & 
w^*\frac{\partial S}{\partial z} + 
\frac{\partial }{\partial z} 
\left(K_S  \frac{\partial S}{\partial z} -\gamma \right) +
\frac{S_{ref} - S}{\tau}
\\w & = & 0 
\\\rho & = & F(T,S,P)
\end{eqnarray}
 -->
<TABLE ALIGN="CENTER" CELLPADDING="0" WIDTH="100%">
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT"><IMG
 WIDTH="26" HEIGHT="51" ALIGN="MIDDLE" BORDER="0"
 SRC="img1.png"
 ALT="$\displaystyle \frac{\partial u}{\partial t}$"></TD>
<TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="16" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$\textstyle =$"></TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="139" HEIGHT="54" ALIGN="MIDDLE" BORDER="0"
 SRC="img3.png"
 ALT="$\displaystyle fv +
\frac{\partial }{\partial z} \left( K_M \frac{\partial u}{\partial z} \right)$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(1)</TD></TR>
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT"><IMG
 WIDTH="26" HEIGHT="51" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$\displaystyle \frac{\partial v}{\partial t}$"></TD>
<TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="16" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$\textstyle =$"></TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="151" HEIGHT="54" ALIGN="MIDDLE" BORDER="0"
 SRC="img5.png"
 ALT="$\displaystyle - fu +
\frac{\partial }{\partial z} \left( K_M \frac{\partial v}{\partial z} \right)$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(2)</TD></TR>
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT"><IMG
 WIDTH="30" HEIGHT="51" ALIGN="MIDDLE" BORDER="0"
 SRC="img6.png"
 ALT="$\displaystyle \frac{\partial P}{\partial z}$"></TD>
<TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="16" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$\textstyle =$"></TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="33" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img7.png"
 ALT="$\displaystyle -\rho g$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(3)</TD></TR>
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT"><IMG
 WIDTH="29" HEIGHT="51" ALIGN="MIDDLE" BORDER="0"
 SRC="img8.png"
 ALT="$\displaystyle \frac{\partial T}{\partial t}$"></TD>
<TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="16" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$\textstyle =$"></TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="276" HEIGHT="54" ALIGN="MIDDLE" BORDER="0"
 SRC="img9.png"
 ALT="$\displaystyle w^*\frac{\partial T}{\partial z} +
\frac{\partial }{\partial z}
\left(K_T \frac{\partial T}{\partial z} -\gamma \right) +
\frac{T_{ref} - T}{\tau}$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(4)</TD></TR>
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT"><IMG
 WIDTH="28" HEIGHT="51" ALIGN="MIDDLE" BORDER="0"
 SRC="img10.png"
 ALT="$\displaystyle \frac{\partial S}{\partial t}$"></TD>
<TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="16" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$\textstyle =$"></TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="273" HEIGHT="54" ALIGN="MIDDLE" BORDER="0"
 SRC="img11.png"
 ALT="$\displaystyle w^*\frac{\partial S}{\partial z} +
\frac{\partial }{\partial z}
\left(K_S \frac{\partial S}{\partial z} -\gamma \right) +
\frac{S_{ref} - S}{\tau}$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(5)</TD></TR>
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT"><IMG
 WIDTH="16" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img12.png"
 ALT="$\displaystyle w$"></TD>
<TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="16" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$\textstyle =$"></TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="12" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img13.png"
 ALT="$\displaystyle 0$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(6)</TD></TR>
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT"><IMG
 WIDTH="12" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img14.png"
 ALT="$\displaystyle \rho$"></TD>
<TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="16" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$\textstyle =$"></TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="76" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img15.png"
 ALT="$\displaystyle F(T,S,P)$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(7)</TD></TR>
</TABLE></DIV><BR CLEAR="ALL"><P></P>

<P>
With the vertical boundary conditions prescribed as follows:

<P>
<BR>
<DIV ALIGN="CENTER"><A NAME="eq:topu"></A><A NAME="eq:topv"></A><A NAME="eq:topT"></A><A NAME="eq:topS"></A><A NAME="eq:botu"></A><A NAME="eq:botv"></A><A NAME="eq:botT"></A><A NAME="eq:botS"></A>
<!-- MATH
 \begin{eqnarray}
\hbox{at the top:  }z=0 & K_M
\frac{\partial u}{\partial z} &= \tau_{surf}^x \\& K_M
\frac{\partial v}{\partial z} &= \tau_{surf}^y \\& K_T
\frac{\partial T}{\partial z} &= \frac{Q_T}{\rho_0 C_p} \\& K_S 
\frac{\partial S}{\partial z} &= \frac{(E-P)S}{\rho_0} \\\hbox{at the bottom:  }z=-h
& K_M \frac{\partial u}{\partial z} &= \tau_{bot}^x \\&
K_M \frac{\partial v}{\partial z} &= \tau_{bot}^y \\&
K_T \frac{\partial T}{\partial z} &= 0 \\& K_S
\frac{\partial S}{\partial z} &= 0 \\
\end{eqnarray}
 -->
<TABLE ALIGN="CENTER" CELLPADDING="0" WIDTH="100%">
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT"><IMG
 WIDTH="123" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img16.png"
 ALT="$\displaystyle \hbox{at the top: }z=0$"></TD>
<TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="51" HEIGHT="36" ALIGN="MIDDLE" BORDER="0"
 SRC="img17.png"
 ALT="$\textstyle K_M
\frac{\partial u}{\partial z}$"></TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="56" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img18.png"
 ALT="$\displaystyle = \tau_{surf}^x$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(8)</TD></TR>
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT">&nbsp;</TD>
<TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="50" HEIGHT="36" ALIGN="MIDDLE" BORDER="0"
 SRC="img19.png"
 ALT="$\textstyle K_M
\frac{\partial v}{\partial z}$"></TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="56" HEIGHT="33" ALIGN="MIDDLE" BORDER="0"
 SRC="img20.png"
 ALT="$\displaystyle = \tau_{surf}^y$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(9)</TD></TR>
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT">&nbsp;</TD>
<TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="48" HEIGHT="36" ALIGN="MIDDLE" BORDER="0"
 SRC="img21.png"
 ALT="$\textstyle K_T
\frac{\partial T}{\partial z}$"></TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="59" HEIGHT="51" ALIGN="MIDDLE" BORDER="0"
 SRC="img22.png"
 ALT="$\displaystyle = \frac{Q_T}{\rho_0 C_p}$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(10)</TD></TR>
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT">&nbsp;</TD>
<TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="47" HEIGHT="36" ALIGN="MIDDLE" BORDER="0"
 SRC="img23.png"
 ALT="$\textstyle K_S
\frac{\partial S}{\partial z}$"></TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="92" HEIGHT="53" ALIGN="MIDDLE" BORDER="0"
 SRC="img24.png"
 ALT="$\displaystyle = \frac{(E-P)S}{\rho_0}$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(11)</TD></TR>
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT"><IMG
 WIDTH="164" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img25.png"
 ALT="$\displaystyle \hbox{at the bottom: }z=-h$"></TD>
<TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="51" HEIGHT="36" ALIGN="MIDDLE" BORDER="0"
 SRC="img17.png"
 ALT="$\textstyle K_M
\frac{\partial u}{\partial z}$"></TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="46" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img26.png"
 ALT="$\displaystyle = \tau_{bot}^x$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(12)</TD></TR>
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT">&nbsp;</TD>
<TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="50" HEIGHT="36" ALIGN="MIDDLE" BORDER="0"
 SRC="img19.png"
 ALT="$\textstyle K_M
\frac{\partial v}{\partial z}$"></TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="46" HEIGHT="33" ALIGN="MIDDLE" BORDER="0"
 SRC="img27.png"
 ALT="$\displaystyle = \tau_{bot}^y$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(13)</TD></TR>
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT">&nbsp;</TD>
<TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="48" HEIGHT="36" ALIGN="MIDDLE" BORDER="0"
 SRC="img21.png"
 ALT="$\textstyle K_T
\frac{\partial T}{\partial z}$"></TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="29" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img28.png"
 ALT="$\displaystyle = 0$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(14)</TD></TR>
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT">&nbsp;</TD>
<TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="47" HEIGHT="36" ALIGN="MIDDLE" BORDER="0"
 SRC="img23.png"
 ALT="$\textstyle K_S
\frac{\partial S}{\partial z}$"></TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="29" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img28.png"
 ALT="$\displaystyle = 0$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(15)</TD></TR>
</TABLE></DIV><BR CLEAR="ALL"><P></P>
Where,

<UL>
<LI>t is the time variable
</LI>
<LI>z is the vertical coordinate in the Cartesian frame,
 increasing towards the top.
</LI>
<LI>u, v, w are components of the
velocity vectors in the Cartesian frame
</LI>
<LI>f is the Coriolis parameter 
</LI>
<LI>T is the potential temperature of the Ocean 
</LI>
<LI>S is the salinity of the Ocean
</LI>
<LI><IMG
 WIDTH="34" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img29.png"
 ALT="$T_{ref}$"> is the potential temperature data towards 
which the temperature is relaxed
</LI>
<LI>S is the salinity of the Ocean
</LI>
<LI><IMG
 WIDTH="35" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img30.png"
 ALT="$S_{ref}$"> is the  salinity data towards 
which the salinity is relaxed
</LI>
<LI><IMG
 WIDTH="13" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img31.png"
 ALT="$\tau$"> is the nudging relaxation time towards data
</LI>
<LI>P is the total pressure 
</LI>
<LI>F is an equation of state of sea water 
</LI>
<LI><IMG
 WIDTH="12" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img32.png"
 ALT="$\rho$"> is the in-situ density perturbation
</LI>
<LI><IMG
 WIDTH="20" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img33.png"
 ALT="$\rho_0$"> is the mean density
</LI>
<LI>g is the acceleration of gravity
</LI>
<LI><IMG
 WIDTH="32" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img34.png"
 ALT="$K_M$">, <IMG
 WIDTH="28" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img35.png"
 ALT="$K_T$">, <IMG
 WIDTH="27" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img36.png"
 ALT="$K_S$"> are the vertical
turbulent mixing coefficients, defined by the KPP vertical turbulent closure scheme 
</LI>
<LI><IMG
 WIDTH="13" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img37.png"
 ALT="$\gamma$"> is a nonlocal transport term in addition to the
down-gradient component
</LI>
<LI><IMG
 WIDTH="39" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img38.png"
 ALT="$\tau_{surf}^x$">, <IMG
 WIDTH="39" HEIGHT="33" ALIGN="MIDDLE" BORDER="0"
 SRC="img39.png"
 ALT="$\tau_{surf}^y$"> are the surface wind stress components 
</LI>
<LI><IMG
 WIDTH="27" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img40.png"
 ALT="$Q_T$"> is the surface heat flux
</LI>
<LI><IMG
 WIDTH="49" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img41.png"
 ALT="$E-P$"> is the evaporation minus 
the precipitation
</LI>
<LI><IMG
 WIDTH="29" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img42.png"
 ALT="$\tau_{bot}^x$">, <IMG
 WIDTH="29" HEIGHT="33" ALIGN="MIDDLE" BORDER="0"
 SRC="img43.png"
 ALT="$\tau_{bot}^y$"> are the bottom stress components, they are
set to 0 
</LI>
<LI>h is the depth of the water column 
</LI>
<LI><IMG
 WIDTH="23" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img44.png"
 ALT="$w^*$"> is an artificial vertical velocity introduced to take the effects 
of an upwelling into account
</LI>
</UL>

<P>
Equations (<A HREF="doc1d.html#eq:umoment">1</A>) and (<A HREF="doc1d.html#eq:vmoment">2</A>) express the momentum
balance in the x and y directions.  
Under the hydrostatic approximation, the
momentum balance (equation <A HREF="doc1d.html#eq:wmoment">3</A>)in the vertical direction limits 
itself to a balance between the
pressure gradient and the buoyancy forces.
Equations (<A HREF="doc1d.html#eq:temp">4</A>) and (<A HREF="doc1d.html#eq:salt">5</A>)
express the time evolution of Temperature and Salinity.  
Equation (<A HREF="doc1d.html#eq:cont">6</A>) expresses the continuity equation for an incompressible 
fluid, that implies in a 1D model the vertical 
velocities to be null.
Equation (<A HREF="doc1d.html#eq:eos">7</A>) gives the equation of state.  

<P>

<H1><A NAME="SECTION01020000000000000000">
2 The stretched vertical coordinate system</A>
</H1>

<P>
(setup_grid.F) 
<BR>
<P>
The equations of motion are discretized following a non-linear vertical
coordinate, in order to increase the resolution near the surface boundary layer. 
The grid  is staggered, with the 'w' points positioned between the '<IMG
 WIDTH="12" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img32.png"
 ALT="$\rho$">' points. 

<P>

<P></P>
<DIV ALIGN="CENTER"><A NAME="fig:staggrid"></A><A NAME="116"></A>
<TABLE>
<CAPTION ALIGN="BOTTOM"><STRONG>Figure 1:</STRONG>
Position of variables on the staggered grid.</CAPTION>
<TR><TD><IMG
 WIDTH="133" HEIGHT="278" BORDER="0"
 SRC="img45.png"
 ALT="\begin{figure}\centerline{\psfig{figure=staggrid.eps,width=3cm}}\end{figure}"></TD></TR>
</TABLE>
</DIV><P></P>

<P>
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
z_{\rho}(i) = -\frac{h \sinh \left(\theta_s \frac{N-i+0.5}{N}\right)}{\sinh(\theta_s)}; 
\;\;\;
i=\{1,2,... \;\; ,N\}
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><A NAME="eq:zr"></A><IMG
 WIDTH="333" HEIGHT="49" BORDER="0"
 SRC="img46.png"
 ALT="\begin{displaymath}
z_{\rho}(i) = -\frac{h \sinh \left(\theta_s \frac{N-i+0.5}{N}\right)}{\sinh(\theta_s)};
\;\;\;
i=\{1,2,... \;\; ,N\}
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(16)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>

<P>
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
z_{w}(i) = -\frac{h \sinh \left(\theta_s \frac{N-i}{N}\right)}{\sinh(\theta_s)}; 
\;\;\;
i=\{0,1,... \;\; ,N\}
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><A NAME="eq:zw"></A><IMG
 WIDTH="310" HEIGHT="49" BORDER="0"
 SRC="img47.png"
 ALT="\begin{displaymath}
z_{w}(i) = -\frac{h \sinh \left(\theta_s \frac{N-i}{N}\right)}{\sinh(\theta_s)};
\;\;\;
i=\{0,1,... \;\; ,N\}
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(17)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>

<P>
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
H_z(i) = N \left(z_{w}(i)-z_{w}(i-1)\right); 
\;\;\;
i=\{1,2,... \;\; ,N\}
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><A NAME="eq:Hz"></A><IMG
 WIDTH="346" HEIGHT="38" BORDER="0"
 SRC="img48.png"
 ALT="\begin{displaymath}
H_z(i) = N \left(z_{w}(i)-z_{w}(i-1)\right);
\;\;\;
i=\{1,2,... \;\; ,N\}
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(18)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>

<P>

<H1><A NAME="SECTION01030000000000000000">
3 Forcing</A>
</H1>

<P>
(set_forces.F) 
<BR>
<P>
The model has been setup to run on a yearly cycle using monthly forcing data. 
These data are stored in an ASCII file 'forces.data':

<BR>
<BR>
<BR>SUSTR "surface u-momentum stress" "Newton meter-2"
<BR><TABLE CELLPADDING=3>
<TR><TD ALIGN="CENTER">0.0109</TD>
<TD ALIGN="CENTER">0.0148</TD>
<TD ALIGN="CENTER">0.0236</TD>
<TD ALIGN="CENTER">0.0248</TD>
<TD ALIGN="CENTER">0.0265</TD>
<TD ALIGN="CENTER">0.0242</TD>
</TR>
<TR><TD ALIGN="CENTER">0.0207</TD>
<TD ALIGN="CENTER">0.0204</TD>
<TD ALIGN="CENTER">0.0185</TD>
<TD ALIGN="CENTER">0.015</TD>
<TD ALIGN="CENTER">0.0125</TD>
<TD ALIGN="CENTER">0.0082</TD>
</TR>
</TABLE>

<BR>
<BR>SVSTR "surface v-momentum stress" "Newton meter-2" 
<BR>...
<BR>
<BR>The temporal mean of the heat and salinity fluxes are removed in order to obtain a yearly
cyclic solution. A temporal linear interpolation is achieved to get the forcing at each
model time step. A diurnal cycle is added to the solar short-wave radiation flux as a
function of the latitude.

<P>

<H1><A NAME="SECTION01040000000000000000">
4 Upwelling</A>
</H1>

<P>
(step3dS.F) 
<BR>
<P>
An arbitrary vertical velocity <IMG
 WIDTH="23" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img44.png"
 ALT="$w^*$"> can be introduced to account for a possible
upwelling that could bring tracers towards the surface (cpp key: UPWELLING). 
This velocity is function 
of an upwelling index (UPW [m<IMG
 WIDTH="12" HEIGHT="17" ALIGN="BOTTOM" BORDER="0"
 SRC="img49.png"
 ALT="$^3$">/s/100m of coastline]) which is given by 
the forcing file. Upwelling indices can be found at 
<BR>http://www.pfeg.noaa.gov/products/PFEL/modeled/indices/upwelling/upwelling.html 
<BR>The vertical velocity is defined in such a way that it is zero at surface and at bottom and 
it is maximum at a given depth (<IMG
 WIDTH="47" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img50.png"
 ALT="$z_{wmax}$"> = -100 m, defined in step3dS.F). 
Three different vertical profiles can be chosen:

<UL>
<LI>Linear (cpp key: LINEAR_W):
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
w^*=\frac{\hbox{UPW}}{100.L} \left\{ \begin{array}{ll}
                       \frac{z}{z_{wmax}} & \hbox{for } z\ge z_{wmax} \\
                       \frac{z + h}{z_{wmax + h}} & \hbox{for } z < z_{wmax}
                       \end{array}\right.
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><A NAME="eq:upw_lin"></A><IMG
 WIDTH="275" HEIGHT="64" BORDER="0"
 SRC="img51.png"
 ALT="\begin{displaymath}
w^*=\frac{\hbox{UPW}}{100.L} \left\{ \begin{array}{ll}
\fra...
...{z_{wmax + h}} &amp; \hbox{for } z &lt; z_{wmax}
\end{array}\right.
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(19)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
</LI>
<LI>Sinuso&#239;dal (cpp key: SINUS_W):
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
w^*=\frac{\hbox{UPW}}{100.L} \left\{ \begin{array}{ll}
         \sin\left(\frac{\pi}{2} \frac{z}{z_{wmax}}\right) & \hbox{for } z\ge z_{wmax} \\
         \sin\left(\frac{\pi}{2} \frac{z + h}{z_{wmax + h}}\right) & \hbox{for } z < z_{wmax}
         \end{array}\right.
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><A NAME="eq:upw_sin"></A><IMG
 WIDTH="328" HEIGHT="67" BORDER="0"
 SRC="img52.png"
 ALT="\begin{displaymath}
w^*=\frac{\hbox{UPW}}{100.L} \left\{ \begin{array}{ll}
\sin...
...x + h}}\right) &amp; \hbox{for } z &lt; z_{wmax}
\end{array}\right.
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(20)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
</LI>
<LI>Parabolic (cpp key: PARAB_W):
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
w^*=\frac{\hbox{UPW}}{100.L} \left\{ \begin{array}{ll}
         \frac{-1}{z_{wmax}^2}z^2
         + \frac{2}{z_{wmax}}z 
         & \hbox{for } z\ge z_{wmax} \\
         \frac{-1}{(z_{wmax}+h)^2}z^2  
         + \frac{2z_{wmax}}{(z_{wmax}+h)^2}z
         + 1 - \left(\frac{z_{wmax}}{z_{wmax}+h}\right)^2
         & \hbox{for } z < z_{wmax}
         \end{array}\right.
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><A NAME="eq:upw_par"></A><IMG
 WIDTH="542" HEIGHT="67" BORDER="0"
 SRC="img53.png"
 ALT="\begin{displaymath}
w^*=\frac{\hbox{UPW}}{100.L} \left\{ \begin{array}{ll}
\fra...
...}+h}\right)^2
&amp; \hbox{for } z &lt; z_{wmax}
\end{array}\right.
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(21)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
</LI>
</UL>
Where,

<UL>
<LI><!-- MATH
 $z_{wmax}= - 100$
 -->
<IMG
 WIDTH="105" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img54.png"
 ALT="$z_{wmax}= - 100$"> m is the vertical position of the maximum in vertical velocities
</LI>
<LI><IMG
 WIDTH="15" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img55.png"
 ALT="$L$"> is the cross shore length scale of the problem. Here, <IMG
 WIDTH="60" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img56.png"
 ALT="$L=300$"> km. 
</LI>
</UL>
If the upwelling is on, an additional term can be added in the tracer equation to take 
into account the global horizontal transport induced by
the upwelling in the surface layers (cpp key: EXPORT):
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
\begin{array}{ll}
\bar{u} \frac{\partial T}{\partial x}
& \sim \frac{U}{L} 
\left(T_{\hbox{off-shore}}-T_{\hbox{coastal}}\right) \\
& \sim \frac{w^*}{z_{wmax}} 
\left(T_{\hbox{off-shore}}-T_{\hbox{coastal}}\right)
\end{array}
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="264" HEIGHT="64" BORDER="0"
 SRC="img57.png"
 ALT="\begin{displaymath}
\begin{array}{ll}
\bar{u} \frac{\partial T}{\partial x}
&amp; \s...
...left(T_{\hbox{off-shore}}-T_{\hbox{coastal}}\right)
\end{array}\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(22)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
In the model, this term takes the form:
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
\begin{array}{ll}
\frac{\hbox{UPW}}{100.L.z_{wmax}}(T_{ref} - T) & \hbox{for } z\ge z_{wmax} \\
0 & \hbox{for } z < z_{wmax}
\end{array}
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="261" HEIGHT="64" BORDER="0"
 SRC="img58.png"
 ALT="\begin{displaymath}
\begin{array}{ll}
\frac{\hbox{UPW}}{100.L.z_{wmax}}(T_{ref} ...
...or } z\ge z_{wmax} \\
0 &amp; \hbox{for } z &lt; z_{wmax}
\end{array}\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(23)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>

<P>

<H1><A NAME="SECTION01050000000000000000">
5 Initial conditions</A>
</H1>

<P>
(setup_initial.F) 
<BR>
<P>
The initial variables are set analytically. The horizontal velocities are set to zero (fluid at
rest). The tracer fields are given by a set of functions to fit a
CalCOFI data mean profile:
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
T_0=5+1.475\times 10^{-3}z+5.65 e^{\frac{z}{100}}+5e^{\frac{z}{500}}
\;\;\;[^{\hbox{o}}\hbox{C}]
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="335" HEIGHT="38" BORDER="0"
 SRC="img59.png"
 ALT="\begin{displaymath}
T_0=5+1.475\times 10^{-3}z+5.65 e^{\frac{z}{100}}+5e^{\frac{z}{500}}
\;\;\;[^{\hbox{o}}\hbox{C}]
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(24)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
S_0=34.28-1.75\times 10^{-4}z+0.8 e^{\frac{z}{200}}+0.2e^{\frac{z}{400}}
 \;\;\;[\hbox{PSU}]
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="371" HEIGHT="38" BORDER="0"
 SRC="img60.png"
 ALT="\begin{displaymath}
S_0=34.28-1.75\times 10^{-4}z+0.8 e^{\frac{z}{200}}+0.2e^{\frac{z}{400}}
\;\;\;[\hbox{PSU}]
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(25)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>

<P>
The initial value for the vertical mixing coefficients is 0.01 for momentum and 0.001 for tracers.
The model can is restart from a file if the cpp key RESTART_OUT is defined.

<P>

<H1><A NAME="SECTION01060000000000000000">
6 Nudging</A>
</H1>

<P>
If the cpp key NUDGE is defined, temperature and salinity (and for the biology,
the nitrates) are relaxed towards their initial values with a relaxation time:

<P>
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
\tau = 2 + 23 e^{\frac{z}{100}} \;\;\;[\hbox{year}^{-1}]
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><A NAME="eq:tau"></A><IMG
 WIDTH="169" HEIGHT="38" BORDER="0"
 SRC="img61.png"
 ALT="\begin{displaymath}
\tau = 2 + 23 e^{\frac{z}{100}} \;\;\;[\hbox{year}^{-1}]
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(26)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
It is   set such that it climbs to about 5 years 
below 200 m but decreases to a max of 25 years at the surface.

<P>

<H1><A NAME="SECTION01070000000000000000">
7 Equation of state</A>
</H1>

<P>
(rho_eos.F) 
<BR>
<P>
The density, needed for the turbulent mixing closure scheme, is computed using the
equation of state for sea water proposed by  Jackett and McDougall (1995).
The compression terms are neglected.
<BR>
<DIV ALIGN="CENTER">

<!-- MATH
 \begin{eqnarray}
\rho &=& 999.842594+6.793952\times 10^{-2}T \nonumber
        -9.095290\times 10^{-3}T^2+1.001685\times 10^{-4}T^3 
        \\&& \nonumber
        - 1.120083\times 10^{-6}T^4+6.536332\times 10^{-9}T^5  
        \\&& \nonumber
        + S\left(\begin{array}{l}
                 0.824493
                 -4.08990\times 10^{-3}T
                +7.64380\times 10^{-5}T^2 \\
                -8.24670\times 10^{-7}T^3
                +5.38750\times 10^{-9}T^4 
                \end{array}\right) \\&& 
        +\sqrt{S}\left(\begin{array}{l}
                       -5.72466\times 10^{-3}
                       +1.02270\times 10^{-4}T \\
                      -1.65460\times 10^{-6}T^2
                      +4.8314\times 10^{-4}S
                      \end{array}\right)
\;\;\;[\hbox{kg.m}^{-3}]
\end{eqnarray}
 -->
<TABLE ALIGN="CENTER" CELLPADDING="0" WIDTH="100%">
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT"><IMG
 WIDTH="12" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img14.png"
 ALT="$\displaystyle \rho$"></TD>
<TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="16" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$\textstyle =$"></TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="525" HEIGHT="35" ALIGN="MIDDLE" BORDER="0"
 SRC="img62.png"
 ALT="$\displaystyle 999.842594+6.793952\times 10^{-2}T
-9.095290\times 10^{-3}T^2+1.001685\times 10^{-4}T^3$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
&nbsp;</TD></TR>
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT">&nbsp;</TD>
<TD>&nbsp;</TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="299" HEIGHT="35" ALIGN="MIDDLE" BORDER="0"
 SRC="img63.png"
 ALT="$\displaystyle - 1.120083\times 10^{-6}T^4+6.536332\times 10^{-9}T^5$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
&nbsp;</TD></TR>
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT">&nbsp;</TD>
<TD>&nbsp;</TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="412" HEIGHT="73" ALIGN="MIDDLE" BORDER="0"
 SRC="img64.png"
 ALT="$\displaystyle + S\left(\begin{array}{l}
0.824493
-4.08990\times 10^{-3}T
+7.643...
...}T^2 \\
-8.24670\times 10^{-7}T^3
+5.38750\times 10^{-9}T^4
\end{array}\right)$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
&nbsp;</TD></TR>
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT">&nbsp;</TD>
<TD>&nbsp;</TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="425" HEIGHT="73" ALIGN="MIDDLE" BORDER="0"
 SRC="img65.png"
 ALT="$\displaystyle +\sqrt{S}\left(\begin{array}{l}
-5.72466\times 10^{-3}
+1.02270\t...
...s 10^{-6}T^2
+4.8314\times 10^{-4}S
\end{array}\right)
\;\;\;[\hbox{kg.m}^{-3}]$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(27)</TD></TR>
</TABLE></DIV><BR CLEAR="ALL"><P></P>

<P>

<H1><A NAME="SECTION01080000000000000000">
8 Mixing closure sub-model</A>
</H1>
The parameterization of the vertical mixing processes 
in ROMS is done via a non-local, K-profile planetary  
(KPP) boundary layer scheme [Large et al.,1994].
Two distinct parameterizations are conducted: one for 
the ocean interior and one for the oceanic surface 
boundary layer. The boundary layer depth (h) depends on the 
surface forcing, the buoyancy and the velocity profile.
It is determined by equating a bulk Richardson number 
relative to the surface to a critical value.  Below the 
boundary layer, the vertical mixing is regarded as the 
superposition of 3 processes: vertical shear, 
internal wave breaking, and double diffusion. 
In the surface layer, the diffusivity is formulated to 
agree with similarity theory of turbulence. At the base 
of the surface layer, both diffusivity and its gradient 
have to match the interior values. 
A non local convective transport is added to the local
down-gradient component.
The KPP model has been 
shown to simulate accurately processes such as convective 
boundary layer deepening, diurnal cycling, and storm forcing.

<P>

<H2><A NAME="SECTION01081000000000000000">
8.1 Interior mixing</A>
</H2>

<P>
(lmd_vmix.F) 
<BR>Richardson number:
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
R_i=
\frac{\frac{-g \frac{\partial \rho}{\partial z}}{\rho_0}} 
{\left(\frac{\partial u}{\partial z}\right)^2+
\left(\frac{\partial v}{\partial z}\right)^2}
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="141" HEIGHT="61" BORDER="0"
 SRC="img66.png"
 ALT="\begin{displaymath}
R_i=
\frac{\frac{-g \frac{\partial \rho}{\partial z}}{\rho_0...
...ial z}\right)^2+
\left(\frac{\partial v}{\partial z}\right)^2}
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(28)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>

<P>
<BR>
<DIV ALIGN="CENTER"><A NAME="eq:km"></A>
<!-- MATH
 \begin{eqnarray}
\nonumber
K_M &= & \underbrace{10^{-4}}_{\hbox{wave breaking}}
\\\nonumber & & +
\underbrace{5.10^{-3}\left(1-
\left(\underbrace{\frac{Ri}{0.7}} 
_{0\le ... \le 1}\right)^2
\right)^3}_{\hbox{shear instability mixing}}
 \\& & +
\underbrace{0.1}_{\hbox{static instability ( if }
\frac{\partial \rho}{\partial z}< 0 \hbox{)}}
\end{eqnarray}
 -->
<TABLE ALIGN="CENTER" CELLPADDING="0" WIDTH="100%">
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT"><IMG
 WIDTH="32" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img67.png"
 ALT="$\displaystyle K_M$"></TD>
<TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="16" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$\textstyle =$"></TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="103" HEIGHT="67" ALIGN="MIDDLE" BORDER="0"
 SRC="img68.png"
 ALT="$\displaystyle \underbrace{10^{-4}}_{\hbox{wave breaking}}$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
&nbsp;</TD></TR>
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT">&nbsp;</TD>
<TD>&nbsp;</TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="209" HEIGHT="140" ALIGN="MIDDLE" BORDER="0"
 SRC="img69.png"
 ALT="$\displaystyle +
\underbrace{5.10^{-3}\left(1-
\left(\underbrace{\frac{Ri}{0.7}}
_{0\le ... \le 1}\right)^2
\right)^3}_{\hbox{shear instability mixing}}$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
&nbsp;</TD></TR>
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT">&nbsp;</TD>
<TD>&nbsp;</TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="202" HEIGHT="71" ALIGN="MIDDLE" BORDER="0"
 SRC="img70.png"
 ALT="$\displaystyle +
\underbrace{0.1}_{\hbox{static instability ( if }
\frac{\partial \rho}{\partial z}&lt; 0 \hbox{)}}$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(29)</TD></TR>
</TABLE></DIV><BR CLEAR="ALL"><P></P>

<P>
<BR>
<DIV ALIGN="CENTER"><A NAME="eq:kt"></A>
<!-- MATH
 \begin{eqnarray}
\nonumber
K_T &= & \underbrace{10^{-3}}_{\hbox{wave breaking}}
\\\nonumber & & +
\underbrace{5.10^{-3}\left(1-
\left(\underbrace{\frac{Ri}{0.7}} 
_{0\le ... \le 1}\right)^2
\right)^3}_{\hbox{shear instability mixing}}
 \\\nonumber & & +
\underbrace{0.1}_{\hbox{static instability ( if }
\frac{\partial \rho}{\partial z}< 0 \hbox{)}}  
\\& & + 
\underbrace{K_T^{dd}}_{\hbox{double diffusion}}
\end{eqnarray}
 -->
<TABLE ALIGN="CENTER" CELLPADDING="0" WIDTH="100%">
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT"><IMG
 WIDTH="28" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img71.png"
 ALT="$\displaystyle K_T$"></TD>
<TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="16" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$\textstyle =$"></TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="103" HEIGHT="67" ALIGN="MIDDLE" BORDER="0"
 SRC="img72.png"
 ALT="$\displaystyle \underbrace{10^{-3}}_{\hbox{wave breaking}}$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
&nbsp;</TD></TR>
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT">&nbsp;</TD>
<TD>&nbsp;</TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="209" HEIGHT="140" ALIGN="MIDDLE" BORDER="0"
 SRC="img69.png"
 ALT="$\displaystyle +
\underbrace{5.10^{-3}\left(1-
\left(\underbrace{\frac{Ri}{0.7}}
_{0\le ... \le 1}\right)^2
\right)^3}_{\hbox{shear instability mixing}}$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
&nbsp;</TD></TR>
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT">&nbsp;</TD>
<TD>&nbsp;</TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="202" HEIGHT="71" ALIGN="MIDDLE" BORDER="0"
 SRC="img70.png"
 ALT="$\displaystyle +
\underbrace{0.1}_{\hbox{static instability ( if }
\frac{\partial \rho}{\partial z}&lt; 0 \hbox{)}}$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
&nbsp;</TD></TR>
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT">&nbsp;</TD>
<TD>&nbsp;</TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="130" HEIGHT="69" ALIGN="MIDDLE" BORDER="0"
 SRC="img73.png"
 ALT="$\displaystyle +
\underbrace{K_T^{dd}}_{\hbox{double diffusion}}$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(30)</TD></TR>
</TABLE></DIV><BR CLEAR="ALL"><P></P>

<P>

<H2><A NAME="SECTION01082000000000000000">
8.2 Double diffusion</A>
</H2>
double-diffusion density ration <IMG
 WIDTH="24" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img74.png"
 ALT="$R_\rho$">:

<P>
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
R_\rho=\frac{\alpha \frac{\partial T}{\partial z}}
{\beta \frac{\partial S}{\partial z}}
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><A NAME="eq:rrho"></A><IMG
 WIDTH="74" HEIGHT="52" BORDER="0"
 SRC="img75.png"
 ALT="\begin{displaymath}
R_\rho=\frac{\alpha \frac{\partial T}{\partial z}}
{\beta \frac{\partial S}{\partial z}}
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(31)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
Where  <IMG
 WIDTH="15" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img76.png"
 ALT="$\alpha$"> and <IMG
 WIDTH="14" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img77.png"
 ALT="$\beta$"> are the thermodynamic expansion coefficients for 
temperature and salinity.

<P>

<UL>
<LI>Salt fingering case: warm salty water over cold fresh water (<IMG
 WIDTH="53" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img78.png"
 ALT="$R_\rho&gt;1$"> 
and <!-- MATH
 $\beta \frac{\partial S}{\partial z}>0$
 -->
<IMG
 WIDTH="63" HEIGHT="36" ALIGN="MIDDLE" BORDER="0"
 SRC="img79.png"
 ALT="$\beta \frac{\partial S}{\partial z}&gt;0$">):

<P>
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
K_T^{dd} =  7.10^{-4}\left(1-\left(\frac{min(R_\rho,1.9)-1}{0.9}
\right)^2\right)^3
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><A NAME="eq:ktdd1"></A><IMG
 WIDTH="307" HEIGHT="58" BORDER="0"
 SRC="img80.png"
 ALT="\begin{displaymath}
K_T^{dd} = 7.10^{-4}\left(1-\left(\frac{min(R_\rho,1.9)-1}{0.9}
\right)^2\right)^3
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(32)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>

<P>
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
K_S^{dd} =  10^{-3}\left(1-\left(\frac{min(R_\rho,1.9)-1}{0.9}
\right)^2\right)^3
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><A NAME="eq:ksdd1"></A><IMG
 WIDTH="295" HEIGHT="58" BORDER="0"
 SRC="img81.png"
 ALT="\begin{displaymath}
K_S^{dd} = 10^{-3}\left(1-\left(\frac{min(R_\rho,1.9)-1}{0.9}
\right)^2\right)^3
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(33)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>

<P>
</LI>
<LI>Diffusive convection case: cold fresh water over warm salty water
(<IMG
 WIDTH="82" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img82.png"
 ALT="$0&lt;R_\rho&lt;1$"> and <!-- MATH
 $\beta \frac{\partial S}{\partial z}<0$
 -->
<IMG
 WIDTH="63" HEIGHT="36" ALIGN="MIDDLE" BORDER="0"
 SRC="img83.png"
 ALT="$\beta \frac{\partial S}{\partial z}&lt;0$">):

<P>
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
K_T^{dd} =  
1.3635\times10^{-6}
e^{\left( 4.6e^{\left(-0.54(R_\rho^{-1}-1)\right)}\right)}
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><A NAME="eq:ktdd2"></A><IMG
 WIDTH="280" HEIGHT="41" BORDER="0"
 SRC="img84.png"
 ALT="\begin{displaymath}
K_T^{dd} =
1.3635\times10^{-6}
e^{\left( 4.6e^{\left(-0.54(R_\rho^{-1}-1)\right)}\right)}
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(34)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>

<P>
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
K_S^{dd}=\left\{
        \begin{array}{ll}
       0.15K_T^{dd}R_\rho & \mbox{for }  R_\rho<0.5\\
       K_T^{dd}(1.85R_\rho-0.85)
        &  \mbox{otherwise}
        \end{array}
\right.
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><A NAME="eq:ksdd2"></A><IMG
 WIDTH="310" HEIGHT="64" BORDER="0"
 SRC="img85.png"
 ALT="\begin{displaymath}
K_S^{dd}=\left\{
\begin{array}{ll}
0.15K_T^{dd}R_\rho &amp; \m...
...^{dd}(1.85R_\rho-0.85)
&amp; \mbox{otherwise}
\end{array}\right.
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(35)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
</LI>
</UL>

<P>

<H2><A NAME="SECTION01083000000000000000">
8.3 Boundary layer mixing</A>
</H2>

<P>
(lmd_kpp.F, lmd_swfrac.F, lmd_wscale.F)  

<P>

<H3><A NAME="SECTION01083100000000000000">
8.3.1 Thickness of the boundary layer</A>
</H3>
Compute the depth (<IMG
 WIDTH="24" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img86.png"
 ALT="$h_{bl}$">) at which the bulk Richardson number 
reaches its critical value (<IMG
 WIDTH="76" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img87.png"
 ALT="$Ri_c=0.3)$">. 

<P>
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
Ri_{bulk}(h_{bl})=\frac{-g(\rho_{surf}-\rho(h_{bl}))h_{bl}}
{\rho_0\left[ \left(u_{surf}-u(h_{bl})\right)^2+
\left(v_{surf}-v(h_{bl})\right)^2+V_t^2(h_{bl})\right]}
=Ri_c=0.3
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><A NAME="eq:ribulk"></A><IMG
 WIDTH="542" HEIGHT="60" BORDER="0"
 SRC="img88.png"
 ALT="\begin{displaymath}
Ri_{bulk}(h_{bl})=\frac{-g(\rho_{surf}-\rho(h_{bl}))h_{bl}}
...
...ft(v_{surf}-v(h_{bl})\right)^2+V_t^2(h_{bl})\right]}
=Ri_c=0.3
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(36)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>

<P>
Where <!-- MATH
 $\frac{V_t}{h_{bl}}$
 -->
<IMG
 WIDTH="25" HEIGHT="36" ALIGN="MIDDLE" BORDER="0"
 SRC="img89.png"
 ALT="$\frac{V_t}{h_{bl}}$"> is the turbulent velocity shear:

<P>
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
V_t^2(h_{bl})=\frac{C_v \sqrt{-\beta_T}}{Ri_c \kappa^2}
\sqrt{c_s \epsilon}
h_{bl}N w_s
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><A NAME="eq:vt2"></A><IMG
 WIDTH="224" HEIGHT="47" BORDER="0"
 SRC="img90.png"
 ALT="\begin{displaymath}
V_t^2(h_{bl})=\frac{C_v \sqrt{-\beta_T}}{Ri_c \kappa^2}
\sqrt{c_s \epsilon}
h_{bl}N w_s
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(37)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
Where,

<UL>
<LI><IMG
 WIDTH="67" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img91.png"
 ALT="$Cv=1.8$"> : ratio of the interior Brunt-V&#228;is&#228;l&#228; frequency
to the Brunt-V&#228;is&#228;l&#228; frequency at the entrainment depth
</LI>
<LI><IMG
 WIDTH="77" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img92.png"
 ALT="$\beta_T=-0.2$"> : ratio of entrainment buoyancy flux to surface buoyancy flux
</LI>
<LI><IMG
 WIDTH="55" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img93.png"
 ALT="$\kappa=0.4$"> : von K&#225;rm&#225;n's constant
</LI>
<LI><IMG
 WIDTH="76" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img94.png"
 ALT="$c_s=98.96$"> constant used in the calculation of the dimensionless flux profiles
</LI>
<LI><IMG
 WIDTH="52" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img95.png"
 ALT="$\epsilon=0.1$"> non-dimensional extent of the surface layer
</LI>
<LI><IMG
 WIDTH="19" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img96.png"
 ALT="$N$"> Brunt-V&#228;is&#228;l&#228; frequency
</LI>
<LI><IMG
 WIDTH="22" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img97.png"
 ALT="$w_s$"> turbulent velocity scale for scalars
</LI>
</UL>
In case of stable buoyancy forcing (<IMG
 WIDTH="54" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img98.png"
 ALT="$B_f &gt; 0$">), <IMG
 WIDTH="24" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img86.png"
 ALT="$h_{bl}$"> is taken as the minimum of
the <IMG
 WIDTH="24" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img86.png"
 ALT="$h_{bl}$"> computed above, the Monin-Obukov length <!-- MATH
 $L_{mo}=\frac{u^{*3}}{\kappa B_f}$
 -->
<IMG
 WIDTH="83" HEIGHT="40" ALIGN="MIDDLE" BORDER="0"
 SRC="img99.png"
 ALT="$L_{mo}=\frac{u^{*3}}{\kappa B_f}$"> 
and the Ekman depth <!-- MATH
 $h_e=\frac{0.7u^*}{f}$
 -->
<IMG
 WIDTH="76" HEIGHT="37" ALIGN="MIDDLE" BORDER="0"
 SRC="img100.png"
 ALT="$h_e=\frac{0.7u^*}{f}$">, where <!-- MATH
 $u^*=\frac{|\tau_0|}{\rho_0}$
 -->
<IMG
 WIDTH="65" HEIGHT="40" ALIGN="MIDDLE" BORDER="0"
 SRC="img101.png"
 ALT="$u^*=\frac{\vert\tau_0\vert}{\rho_0}$"> is
the friction velocity and <!-- MATH
 $B_f = g (\alpha Q_{total} - \beta (E-P)S - 
\frac{\alpha I{h_bl}}{\rho C_p})$
 -->
<IMG
 WIDTH="269" HEIGHT="36" ALIGN="MIDDLE" BORDER="0"
 SRC="img102.png"
 ALT="$B_f = g (\alpha Q_{total} - \beta (E-P)S -
\frac{\alpha I{h_bl}}{\rho C_p})$"> is the forcing buoyancy. <IMG
 WIDTH="15" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img76.png"
 ALT="$\alpha$"> is the thermal expansion 
coefficient and <IMG
 WIDTH="14" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img77.png"
 ALT="$\beta$"> is the saline contraction coefficient.

<P>

<H3><A NAME="SECTION01083200000000000000">
8.3.2 Turbulent velocity scales</A>
</H3>

<UL>
<LI>for scalars:
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
w_s=\left\{
        \begin{array}{ll}
      \kappa  \sqrt[3]{-28.86u^{*3}+98.96\kappa \sigma w^{*3}}
        & \mbox{for } \sigma<\epsilon\\
      \kappa  \sqrt[3]{-28.86u^{*3}+98.96\kappa \epsilon w^{*3}}
        & \mbox{for } \sigma \ge \epsilon
        \end{array}
\right.
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><A NAME="eq:ws"></A><IMG
 WIDTH="334" HEIGHT="64" BORDER="0"
 SRC="img103.png"
 ALT="\begin{displaymath}
w_s=\left\{
\begin{array}{ll}
\kappa \sqrt[3]{-28.86u^{*3}...
...w^{*3}}
&amp; \mbox{for } \sigma \ge \epsilon
\end{array}\right.
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(38)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
</LI>
<LI>for momentum:
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
w_m=\left\{
        \begin{array}{ll}
      \kappa  \sqrt[3]{1.26u^{*3}+8.38\kappa \sigma w^{*3}}
        & \mbox{for } \sigma<\epsilon\\
      \kappa  \sqrt[3]{1.26u^{*3}+8.38\kappa \epsilon w^{*3}}
        & \mbox{for } \sigma \ge \epsilon
        \end{array}
\right.
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><A NAME="eq:wm"></A><IMG
 WIDTH="310" HEIGHT="64" BORDER="0"
 SRC="img104.png"
 ALT="\begin{displaymath}
w_m=\left\{
\begin{array}{ll}
\kappa \sqrt[3]{1.26u^{*3}+8...
...w^{*3}}
&amp; \mbox{for } \sigma \ge \epsilon
\end{array}\right.
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(39)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
</LI>
</UL>

<P>

<H3><A NAME="SECTION01083300000000000000">
8.3.3 Profiles of diffusivities</A>
</H3>
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
K_x = h_{bl}w_x(\sigma)G(\sigma), \;\;\; \hbox{where }x=M,T,S
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="286" HEIGHT="38" BORDER="0"
 SRC="img105.png"
 ALT="\begin{displaymath}
K_x = h_{bl}w_x(\sigma)G(\sigma), \;\;\; \hbox{where }x=M,T,S
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(40)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
Where <IMG
 WIDTH="39" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img106.png"
 ALT="$G(\sigma)$"> is a cubic polynomial, such as 

<P>
<BR>
<DIV ALIGN="CENTER">

<!-- MATH
 \begin{eqnarray}
G(0)  =  & 0 &\;\;\; \hbox{K=0 at surface} \\
\frac{\partial G(0)}{\partial \sigma}  = & 1 
&\;\;\;
\hbox{linear reduction of flux with distance in the surface
layer} \\
G(1)  = &
\frac{K(h_{bl})}{h_{bl}w(1)} &\;\;\;
\left\{         
\begin{array}{l}
\mbox{Match of the boundary layer and
interior diffusivities} \\
\mbox{ at the bottom of the boundary layer}\\
\end{array}
\right. \\
\frac{\partial G(1)}{\partial \sigma}  = & 
\frac{\partial}{\partial \sigma} 
\left( \frac{K(h_{bl})}{h_{bl}w(1)} \right) 
&\;\;\;
\left\{         
\begin{array}{l}
\mbox{Match of the boundary layer and interior derivatives of} \\
\mbox{the diffusivities at the bottom of the boundary layer}\\
\end{array}
\right.
\end{eqnarray}
 -->
<TABLE ALIGN="CENTER" CELLPADDING="0" WIDTH="100%">
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT"><IMG
 WIDTH="54" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img107.png"
 ALT="$\displaystyle G(0) =$"></TD>
<TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="12" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img108.png"
 ALT="$\textstyle 0$"></TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="123" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img109.png"
 ALT="$\displaystyle \;\;\; \hbox{K=0 at surface}$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(41)</TD></TR>
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT"><IMG
 WIDTH="67" HEIGHT="53" ALIGN="MIDDLE" BORDER="0"
 SRC="img110.png"
 ALT="$\displaystyle \frac{\partial G(0)}{\partial \sigma} =$"></TD>
<TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="12" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img111.png"
 ALT="$\textstyle 1$"></TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="413" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img112.png"
 ALT="$\displaystyle \;\;\;
\hbox{linear reduction of flux with distance in the surface
layer}$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(42)</TD></TR>
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT"><IMG
 WIDTH="54" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img113.png"
 ALT="$\displaystyle G(1) =$"></TD>
<TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="51" HEIGHT="40" ALIGN="MIDDLE" BORDER="0"
 SRC="img114.png"
 ALT="$\textstyle \frac{K(h_{bl})}{h_{bl}w(1)}$"></TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="421" HEIGHT="73" ALIGN="MIDDLE" BORDER="0"
 SRC="img115.png"
 ALT="$\displaystyle \;\;\;
\left\{
\begin{array}{l}
\mbox{Match of the boundary layer...
...sivities} \\
\mbox{ at the bottom of the boundary layer}\\
\end{array}\right.$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(43)</TD></TR>
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT"><IMG
 WIDTH="67" HEIGHT="53" ALIGN="MIDDLE" BORDER="0"
 SRC="img116.png"
 ALT="$\displaystyle \frac{\partial G(1)}{\partial \sigma} =$"></TD>
<TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="92" HEIGHT="44" ALIGN="MIDDLE" BORDER="0"
 SRC="img117.png"
 ALT="$\textstyle \frac{\partial}{\partial \sigma}
\left( \frac{K(h_{bl})}{h_{bl}w(1)} \right)$"></TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="434" HEIGHT="73" ALIGN="MIDDLE" BORDER="0"
 SRC="img118.png"
 ALT="$\displaystyle \;\;\;
\left\{
\begin{array}{l}
\mbox{Match of the boundary layer...
...ox{the diffusivities at the bottom of the boundary layer}\\
\end{array}\right.$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(44)</TD></TR>
</TABLE></DIV><BR CLEAR="ALL"><P></P>

<P>

<H3><A NAME="SECTION01083400000000000000">
8.3.4 Nonlocal transport</A>
</H3>
The nonlocal transport term <IMG
 WIDTH="13" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img37.png"
 ALT="$\gamma$"> is nonzero only for
scalars in unstable forcing conditions:
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
\gamma = 10 \kappa  \sqrt[3]{c_s\kappa\epsilon} 
\frac{B_f}{h_{bl}w_s}
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="139" HEIGHT="47" BORDER="0"
 SRC="img119.png"
 ALT="\begin{displaymath}
\gamma = 10 \kappa \sqrt[3]{c_s\kappa\epsilon}
\frac{B_f}{h_{bl}w_s}
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(45)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>

<P>

<H1><A NAME="SECTION02000000000000000000">
2 How to run an experiment</A>
</H1>

<H1><A NAME="SECTION02010000000000000000">
9 System requirement</A>
</H1>
The program has been compiled on SGI and Sun workstations.
The system-dependent part of the Makefile is Makedefs.

<P>

<H1><A NAME="SECTION02020000000000000000">
10 Getting the code</A>
</H1>
A tar file containing the program is available at 
http://www.atmos.ucla.edu/<IMG
 WIDTH="16" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img120.png"
 ALT="$\sim$">penven/roms1d

<P>

<H1><A NAME="SECTION02030000000000000000">
11 Define the cpp keys</A>
</H1>
(cppdefs.h)
Before compiling, different options can be chosen by defining different
cpp preprocessing keys in the file cppdefs.h.

<UL>
<LI>SALINITY: define if using salinity
</LI>
<LI>NONLIN_EOS: define if using nonlinear equation of state
</LI>
<LI>LMD_MIXING: select the Large/McWilliams/Doney interior mixing
</LI>
<LI>LMD_RIMIX: add diffusivity due to shear instability
</LI>
<LI>LMD_CONVEC: add convective mixing due to shear instability 
</LI>
<LI>LMD_DDMIX: add double-diffusive mixing 
</LI>
<LI>LMD_KPP: select Large/McWilliams/Doney Oceanic 
Planetary Boundary Layer scheme
</LI>
<LI>LMD_NONLOCAL: turn on or off nonlocal transport 
</LI>
<LI>BIOLOGY: turn on or off the biological module
</LI>
<LI>BIO_OCEAN: set the biological module to oceanic species
</LI>
<LI>UPWELLING: turn on or off the upwelling 
</LI>
<LI>LINEAR_W: linear profile of vertical velocities
</LI>
<LI>SINUS_W: sinusoidal profile of vertical velocities
</LI>
<LI>PARAB_W: parabolic profile of vertical velocities
</LI>
<LI>EXPORT: parameterization of horizontal transport 
</LI>
<LI>OXYGEN:  define if using oxygen
</LI>
<LI>NCARG: define if using in-line NCAR graphics plotting routines
</LI>
<LI>NUDGE: nudging of tracers towards the initial values
</LI>
<LI>RESTART_OUT: define if writing in a restart output file
</LI>
<LI>RESTART_IN: define if reading initial values in a restart input file 
</LI>
<LI>BIN_OUTPUT:  define if writing in a binary output file
</LI>
<LI>ASCII_OUTPUT:  define if writing in an ASCII output file
</LI>
</UL>

<P>

<H1><A NAME="SECTION02040000000000000000">
12 Define the vertical grid and the initial conditions</A>
</H1>

<H2><A NAME="SECTION02041000000000000000">
12.1 Vertical grid</A>
</H2>

<P>
The number of vertical levels (N), the Coriolis parameteris (f)
and the latitude (latr) are defined in the file param.h.
The water column total depth (hmax) and the grid streching parameter 
(theta_s) are defined in the file setup_grid.F.

<P>

<H2><A NAME="SECTION02042000000000000000">
12.2 Initial conditions</A>
</H2>
If not restarting the simulation from a file, initial analytical 
values of the variables can be changed in the file setup_initial.F.

<P>

<H2><A NAME="SECTION02043000000000000000">
12.3 Upwelling</A>
</H2>

<P>
The arbitrary function defining the rate of upwelling can be changed
in step3dS.F.

<P>

<H2><A NAME="SECTION02044000000000000000">
12.4 Running parameters</A>
</H2>

<P>
For the moment, the running parameters are defined in main.F.

<UL>
<LI>dt: time step in seconds
</LI>
<LI>ntimes: total number time-steps in current run
</LI>
<LI>nwrite: number of time-steps between making a plot
</LI>
<LI>noutput: number of time-steps between writing in output file
</LI>
<LI>nrestart: number of time-steps between writing in restart file
</LI>
<LI>twrite: number of days before starting to write and to plot
</LI>
</UL>

<P>

<H1><A NAME="SECTION02050000000000000000">
13 Compile</A>
</H1>

<P>
Choose a Makedefs.* that match your system and copy it to Makedefs
type make clobber and make all

<UL>
<LI>make clobber: remove all the executables, the .o files, 
the .dat files ...
</LI>
<LI>make clean: remove all the .o files
</LI>
<LI>make tools: compile mpc (precompiling processor designed 
to work between CPP and FORTRAN compiler) and cross_matrix 
(analyzer of dependencies to build the dependencies ``Make.depend'')
</LI>
<LI>make depend: apply cross_matrix
</LI>
<LI>make roms1d: compile the program
</LI>
<LI>make all: tools + depend + roms1d
</LI>
</UL>

<P>

<H1><A NAME="SECTION02060000000000000000">
14 Prepare the forcing file</A>
</H1>

<P>
The model has been setup in a way that it reads monthly forcing values.
The forcing values are stored in the file forces.data. 

<BR>
<BR>SUSTR "surface u-momentum stress" "Newton meter-2"
<BR><TABLE CELLPADDING=3>
<TR><TD ALIGN="CENTER">0.0109</TD>
<TD ALIGN="CENTER">0.0148</TD>
<TD ALIGN="CENTER">0.0236</TD>
<TD ALIGN="CENTER">0.0248</TD>
<TD ALIGN="CENTER">0.0265</TD>
<TD ALIGN="CENTER">0.0242</TD>
</TR>
<TR><TD ALIGN="CENTER">0.0207</TD>
<TD ALIGN="CENTER">0.0204</TD>
<TD ALIGN="CENTER">0.0185</TD>
<TD ALIGN="CENTER">0.015</TD>
<TD ALIGN="CENTER">0.0125</TD>
<TD ALIGN="CENTER">0.0082</TD>
</TR>
</TABLE>
<BR>
<BR>
<BR>These values correspond to the months:
<BR>
<BR><TABLE CELLPADDING=3>
<TR><TD ALIGN="CENTER">January</TD>
<TD ALIGN="CENTER">February</TD>
<TD ALIGN="CENTER">March</TD>
<TD ALIGN="CENTER">April</TD>
<TD ALIGN="CENTER">May</TD>
<TD ALIGN="CENTER">June</TD>
</TR>
<TR><TD ALIGN="CENTER">July</TD>
<TD ALIGN="CENTER">August</TD>
<TD ALIGN="CENTER">September</TD>
<TD ALIGN="CENTER">October</TD>
<TD ALIGN="CENTER">November</TD>
<TD ALIGN="CENTER">December</TD>
</TR>
</TABLE>

<BR>
<BR>This setup can be changed in the file set_forces.F.

<P>

<H1><A NAME="SECTION02070000000000000000">
15 Run</A>
</H1>

<P>
Type ``roms1d'' alone or ``roms1d <IMG
 WIDTH="16" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img121.png"
 ALT="$&gt;$"> roms.out SPMamp;'' to have a record
of the model evolution 

<P>

<H1><A NAME="SECTION02080000000000000000">
16 Get the results</A>
</H1>

<P>

<UL>
<LI>If the cpp key NCARG is defined, the NCAR Graphics routines produce a 
gmeta file containing an image every nwrite time-step during the simulation. 
This file can be used for a quick check of the results.
</LI>
<LI>If the cpp key BIN_OUTPUT is defined, all the velocities, all the tracers 
and the depth of the surface oceanic boundary layer are stored every noutput time-step
in single precision into the binary file ``fort.70'', using the command:
          write(70) u,v,t,h<IMG
 WIDTH="18" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img122.png"
 ALT="$_{\hbox{bl}}$">
</LI>
<LI>If the cpp key ASCII_OUTPUT is defined, the depth of the vertical levels are 
stored in the file ``z.dat'', and every noutput time-step,

<UL>
<LI>the time is stored in the file ``days.dat''
</LI>
<LI>the depth of the oceanic boundary layer is stored in the file ``zbl.dat''
</LI>
<LI>the horizontal velocities are stored in the files ``u.dat'' and ``v.dat''
</LI>
<LI>all the tracers are stored in the files ``tXX.dat'', where XX is 01 for temperature, 
02 for salinity, ...
</LI>
</UL>
The variables stored in the ASCII files can be visualized with MATLAB using the function
``tzplot(vname)'', where vname is the name of the variable: ``u'', ``v'', ``t01'', ``t02''...
</LI>
<LI>If the cpp key RESTART_OUT is defined, every nrestart time-step, 
all the velocities and all the tracers are stored in double precision 
into the binary file ``fort.50'', using the command:
          write(50) u,v,t 
<BR>The number of restart outputs is stored in the ASCII file ``fort.51''. 
</LI>
</UL>

<P>
 
<H2><A NAME="SECTION03000000000000000000">
Bibliography</A>
</H2><DL COMPACT><DD>
<P>
<P></P><DT><A NAME="Jac95">1</A>
<DD>
Jackett, D. R. and T. J. McDougall, 
Minimal Adjustment of Hydrostatic Profiles to Achieve Static Stability, 
<I>J. Atmos. Oceanic Techn.</I>, 
<I>12</I>, 
381-389,
1995.

<P>
<P></P><DT><A NAME="Lar94">2</A>
<DD>        
Large, W. G., J. C. McWilliams, and S. C. Doney,
Oceanic vertical mixing: a review and a model 
with a nonlocal boundary layer parameterization,
<I>Rev. Geophys.</I>,
<I>32</I>, 
363-403,
1994.

<P>
</DL>

<P>

<H1><A NAME="SECTION04000000000000000000">
About this document ...</A>
</H1>
 <P>
This document was generated using the
<A HREF="http://www-dsed.llnl.gov/files/programs/unix/latex2html/manual/"><STRONG>LaTeX</STRONG>2<tt>HTML</tt></A> translator Version 2K.1beta (1.50)
<P>
Copyright &#169; 1993, 1994, 1995, 1996,
<A HREF="http://cbl.leeds.ac.uk/nikos/personal.html">Nikos Drakos</A>, 
Computer Based Learning Unit, University of Leeds.
<BR>Copyright &#169; 1997, 1998, 1999,
<A HREF="http://www.maths.mq.edu.au/~ross/">Ross Moore</A>, 
Mathematics Department, Macquarie University, Sydney.
<P>
The command line arguments were: <BR>
 <STRONG>latex2html</STRONG> <TT>-split 0 -white -show_section_numbers -no_navigation doc1d.tex</TT>
<P>
The translation was initiated by Penven Pierrick on 2001-06-11<BR><HR>
<ADDRESS>
Penven Pierrick
2001-06-11
</ADDRESS>
</BODY>
</HTML>
